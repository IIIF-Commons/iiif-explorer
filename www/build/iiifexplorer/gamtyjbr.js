/*! Built with http://stenciljs.com */
const{h:e}=window.iiifexplorer;class t{constructor(){this._parentCollections=[],this.upLevelEnabled=!0,this.data=null}watchHandler(){this._reset()}componentWillLoad(){this._reset()}_reset(){this._manifest=null,this._selectedManifest=null,this._selectedCollection=null,this._parentCollections=[],this.manifest&&manifesto.loadManifest(this.manifest).then(e=>{const t=manifesto.create(e);t.getProperty("within")&&this._followWithin(t).then(e=>{this._parentCollections=e;let t=e.pop();for(;t&&!t.isCollection();)t=e.pop();this._switchToFolder(t)}),t.isCollection()?this._switchToFolder(t):(this._manifest=t,this._updateState())}).catch(function(e){console.error(e),console.error("failed to load manifest")})}_gotoBreadcrumb(e){let t=this._parentCollections.indexOf(e);this._selectedCollection=this._parentCollections[t],this._parentCollections=this._parentCollections.slice(0,t+1),this._selectedManifest=null,this._updateState()}_sortCollectionsFirst(e,t){let i=e.getIIIFResourceType().value,l=t.getIIIFResourceType().value;if(i===l){let i=Manifesto.LanguageMap.getValue(e.getLabel()),l=Manifesto.LanguageMap.getValue(t.getLabel());if(i&&l)return i<l?-1:1}return l.indexOf("collection")-i.indexOf("collection")}_switchToFolder(e){e.isLoaded?(e.items.sort(this._sortCollectionsFirst),this._parentCollections.push(e),this._selectedCollection=e,this._selectedManifest=null,this._updateState()):e.load().then(this._switchToFolder.bind(this))}_followWithin(e){return new Promise((t,i)=>{let l=e.getProperty("within");Array.isArray(l)&&t([]),Manifesto.Utils.loadResource(l).then(i=>{const l=manifesto.create(i);l.getProperty("within")?this._followWithin(l).then(i=>{i.push(e),t(i)}):t([l,e])}).catch(i)})}_updateState(){this.data={manifest:this._manifest,parentCollections:this._parentCollections,selectedCollection:this._selectedCollection,selectedManifest:this._selectedManifest}}reset(){this._reset(),this._updateState()}render(){return this.data?this.data.manifest?e("div",null,e("div",{class:"items"},e("iiif-explorer-item",{item:this.data.manifest,selected:this.data.selectedManifest&&this.data.selectedManifest.id===this._manifest.id}))):e("div",null,e("div",{class:"breadcrumbs"},this.data.parentCollections.map(t=>e("iiif-explorer-breadcrumb",{collection:t}))),e("hr",null),e("div",{class:"items"},this.data.selectedCollection.items.map(t=>e("iiif-explorer-item",{item:t,selected:this._selectedManifest&&this._selectedManifest.id===t.id})))):e("span",null,"loading...")}itemSelected(e){const t=e.detail;t.isCollection()?(this._switchToFolder(t),this.onSelectCollection.emit(t)):(this._selectedManifest=t,this.onSelectManifest.emit(t),this._updateState())}breadcrumbSelected(e){const t=e.detail;this._gotoBreadcrumb(t),this.onUpLevel.emit(t)}static get is(){return"iiif-explorer"}static get properties(){return{data:{state:!0},manifest:{type:String,attr:"manifest",watchCallbacks:["watchHandler"]},reset:{method:!0},upLevelEnabled:{type:Boolean,attr:"up-level-enabled"}}}static get events(){return[{name:"onSelectManifest",method:"onSelectManifest",bubbles:!0,cancelable:!0,composed:!0},{name:"onSelectCollection",method:"onSelectCollection",bubbles:!0,cancelable:!0,composed:!0},{name:"onUpLevel",method:"onUpLevel",bubbles:!0,cancelable:!0,composed:!0}]}static get listeners(){return[{name:"onSelectItem",method:"itemSelected"},{name:"onSelectBreadcrumb",method:"breadcrumbSelected"}]}static get style(){return"iiif-explorer{font-family:sans-serif}iiif-explorer a{display:block;padding:4px 0 4px 0}iiif-explorer .explorer-link{color:inherit;text-decoration:none}iiif-explorer .explorer-link:hover{text-decoration:underline}iiif-explorer .explorer-breadcrumb,iiif-explorer .explorer-folder,iiif-explorer .explorer-resource{padding-left:22px;background-position:1px center;background-repeat:no-repeat}"}}class i{render(){return e("div",{class:"explorer-breadcrumb explorer-item"},e("a",{onClick:()=>this._breadcrumbSelectedHandler(),class:"explorer-breadcrumb-link explorer-link",href:"#",title:this.collection.getDefaultLabel()||"no label"},this.collection.getDefaultLabel()||"no label"))}_breadcrumbSelectedHandler(){this.onSelectBreadcrumb.emit(this.collection)}static get is(){return"iiif-explorer-breadcrumb"}static get properties(){return{collection:{type:"Any",attr:"collection"}}}static get events(){return[{name:"onSelectBreadcrumb",method:"onSelectBreadcrumb",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"iiif-explorer .explorer-breadcrumb{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAOCAYAAAAi2ky3AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AsDDi4GVw+uzgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAaElEQVQoz63TSQ7AIAxDUX/E/a/sLjqIQmkh1EsWL1YU0B6rHzQQTsRuLWAYYzf6hQrste0nNDAASUoKph4ehurk4G5u5SSRe8jM3gCnVeRxRxHkWAHpD+RqFEVsrx1k2aT5a7OHXT9sPGEpJgY7uFwAAAAASUVORK5CYII=);background-position:0 center}"}}var l,s=(function(e){!function(){var t={}.hasOwnProperty;function i(){for(var e=[],l=0;l<arguments.length;l++){var s=arguments[l];if(s){var o=typeof s;if("string"===o||"number"===o)e.push(s);else if(Array.isArray(s))e.push(i.apply(null,s));else if("object"===o)for(var r in s)t.call(s,r)&&s[r]&&e.push(r)}}return e.join(" ")}e.exports?e.exports=i:window.classNames=i}()}(l={exports:{}}),l.exports);class o{constructor(){this.selected=!1}render(){const t=s({selected:this.selected,"explorer-folder":this.item.isCollection(),"explorer-resource":this.item.isManifest()}),i=s({"explorer-folder-link":this.item.isCollection(),"explorer-item-link":this.item.isManifest(),"explorer-link":!0});return e("div",{class:t},e("a",{onClick:()=>this._itemSelectedHandler(),class:i,title:this.item.getDefaultLabel()||"no label"},this.item.getDefaultLabel()||"no label"))}_itemSelectedHandler(){this.onSelectItem.emit(this.item)}static get is(){return"iiif-explorer-item"}static get properties(){return{item:{type:"Any",attr:"item"},selected:{type:Boolean,attr:"selected"}}}static get events(){return[{name:"onSelectItem",method:"onSelectItem",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"iiif-explorer-item .explorer-folder{cursor:pointer;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAOCAYAAAAi2ky3AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AsDDi0N6/AkhQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAARUlEQVQoz+2TMQ4AIAwCwfj/L+PU6KDFpKPeTA4WCACShDMkCQdDsgsvfiujJGWhfOxssSJHFDUUiRFlUfBFT4v67Q0cAw/iHBfP65QbAAAAAElFTkSuQmCC)}iiif-explorer-item .explorer-resource{cursor:pointer;background-position:left top;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAOCAYAAAAi2ky3AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AsDEA8dR038uwAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAARklEQVQoz+2TMQ4AIAgDe8b/f7kubqARV72RhGsZQBFrD6dD29EFyLaAdK+pyAwJSb0imW1SerHJUlg+bcUXPS3i4mnT3QFl8RAdYwbtnAAAAABJRU5ErkJggg==)}iiif-explorer-item .selected{background-color:#000;color:#fff}"}}export{t as IiifExplorer,i as IiifExplorerBreadcrumb,o as IiifExplorerItem};